% llmk: the reference manual
% Copyright 2018-2020 Takuto ASAKURA (wtsnjp)

% +++
% latex = "xelatex"
% +++
\documentclass[draft]{llmk-doc}

% Metadata
\title{llmk: Light {\LaTeX} Make}
\author{Takuto Asakura (wtsnjp)}
\subtitle{Reference Manual}
\date{v0.1.0\quad\today}
\keywords{llmk, build-tool, toml, lua, luatex}

\begin{document}

\maketitle

\section{Overview}

The \prog{llmk} program is yet another build tool specific for {\LaTeX}
documents. Its aim is to provide a simple way to specify a workflow of
processing {\LaTeX} documents and encourage people to always explicitly show
the right workflow for each document.

The main features of \prog{llmk} are all about the above purpose. First, you
can write the workflows either in an external file \code{llmk.toml} or in a
{\LaTeX} document source in a form of magic comments. Further, multiple magic
comment formats can be used. Second, it is fully cross-platform. The only
requirement of the program is the \code{texlua} command; \prog{llmk} makes a
uniform way to describe the workflows available for nearly all {\TeX}
environments. Third, it behaves exactly the same in any environment. At this
point, \prog{llmk} intentionally does not provide any method for user
configuration. Therefore, one can guarantee that a {\LaTeX} document with an
\prog{llmk} setup, the process of typesetting the document must be reproduced
in any {\TeX} environment with the program.

% TODO: explain that llmk is included in TeX Live and MiKTeX when ready

\subsection{Learning \prog{llmk}}

The bundled \href{https://github.com/wtsnjp/llmk/blob/master/README.md}
{\code{README.md}} has a general introduction for the program. If you are new
to \prog{llmk} and looking for a quick guidance, you are recommended to read it
first. Conversely, this document can be regarded as a reference manual: it
contains detailed descriptions for every feature of \prog{llmk} as much as
possible, but unsuitable for getting general ideas of its basic usage.

\begin{samepage}
All official resources are available from the repository on GitHub:
%
\begin{quote}
\url{https://github.com/wtsnjp/llmk}
\end{quote}
%
Notably, you can find some example {\LaTeX} documents with \prog{llmk} setups
in the \href{https://github.com/wtsnjp/llmk/tree/master/examples}
{\code{examples}} directory.
% TODO: mention wiki on github when some contents are gathered?
\end{samepage}

The design concept of \prog{llmk} is described in a separate TUGboat
article~\cite{asakura2020}. It will not give you practical tips, but if you are
interested in the underlying ideas of the program, it should be worth reading.
The differences from other similar tools, \eg\prog{latexmk}~\cite{latexmk} and
\prog{arara}~\cite{arara}, are also discussed in the article.

\subsection{Reporting bugs and requesting features}

If you get trouble with \prog{llmk} or think you have found a bug, please
report it by creating either an issue or a pull request on the GitHub
repository:
%
\begin{quote}
\url{https://github.com/wtsnjp/llmk/issues}
\end{quote}
%
If you do not want to use GitHub for some reasons, it is also fine to directly
send an email to the author (\email{tkt.asakura@gmail.com}).

The \prog{llmk} program is currently version \code{0.x} and still growing in
any aspect. At this moment, requests for new features are also welcome; the
author cannot promise to implement the requested features, but will happy to
take them into account. Before making a request, it is strongly recommended to
read the article about the design concept~\cite{asakura2020}.

One more thing: as you can see, the author of the program is not a native
English speaker. Thus, there should be plenty of grammatical errors and
unnatural sentences in the documentation, including this manual itself.
Correction for such writing issues is particularly welcome.

\section{Command-line interface}

\subsection{Command usage}

The full usage of \prog{llmk} can be summarized as follows:
%
\begin{htcode}
llmk \meta{options} \meta{files}
\end{htcode}

Herein, \meta{options} are the command-line options, that start with the hyphen
letter |-|, and \meta{files} are the arguments for the |llmk| command.

\subsubsection*{Arguments \meta{files}}

You can specify the filenames of the source {\TeX} files, normally the files
with \code{.tex} or \code{.ltx} extensions, as the arguments for the \code{llmk}
command. When one or more \meta{files} are specified, \prog{llmk} will read
either the TOML field (Section~\ref{sec:toml}) or another supported magic
comment (Section~\ref{sec:magic-comment}) in each of the source files and
process it with the specified workflow in the given order.

As well as the \code{tex} command, you can omit the \code{.tex} extensions and
just give the basenames of the files for the argument; when a \meta{basename},
which must not contain any dot letter, is given and the file that exactly
matches to the name does not exist, \prog{llmk} will automatically add the
\code{.tex} extension and process it like any other if the file
|\meta{basename}.tex| exists.

Note that \prog{llmk} naively pass the given filenames to invoked commands.
Filenames that contains special characters of {\TeX}, \eg |#| and |%|, are very
likely to be causes of troubles. Moreover, at this point \prog{llmk} does not
any specific features to take care of multi-byte characters: filenames
including multi-byte characters may work in some cases but can be cause of
problems\footnote{The author admits that \prog{llmk} needs to be enhanced in
this aspect: it should have better features to treat various filenames with
multi-byte characters, though the author is negative to support special
characters of {\TeX}. Suggestions and patches in this direction are especially
welcome.}. Using filenames that contain only the characters in the range of the
ASCII code, except special characters of {\TeX}, is the safest way to go at any
rate.

Alternatively, if the argument is not specified, \prog{llmk} will read the
special TOML file \code{llmk.toml} in the working directory and execute the
workflow specified in the file (see Section~\ref{sec:toml}).

\subsubsection*{Command-line options \meta{options}}

We have tried to implement a GNU-compatible option parser. Short options, each of
which consists of a single letter, must start with a single hyphen |-|.
Multiple short options can be specified with a single hyphen, \eg |-vs| is
equivalent to |-v -s|. Long options have to be following double hyphens |--|.
All options must be specified before the first argument. A string beginning
with a hyphen after the first argument will be treated as an argument starting
with a hyphen.

When two or more options are specified, \prog{llmk} applies them in the given
order. If conflicting options are specified, \eg \sopt{q} v.s.\ \sopt{v}, the
option in the latter position wins over the former one.

The following is the full list of available command-line options:

\begin{clopt}{\sopt{c}, \lopt{clean}}
Removes temporary files such as \code{aux} and \code{log} files. The files
removed with this action can be customized with the key \ckey{clean\_files}.
\end{clopt}

\begin{clopt}{\sopt{C}, \lopt{clobber}}
Removes all generated files including final PDFs. The files removed with this
action can be customized with the key \ckey{clobber\_files}.
\end{clopt}

\begin{clopt}{%
  \code{\sopt{d} \meta{category}}, \code{\lopt{debug}=\meta{category}},
  \sopt{D}, \lopt{debug}}
Activates the specified debug category; debugging messages related to the
activated category will be shown. Herein, available debug categories are:
|config|, |parser|, |run|, |fdb|, |programs|, and |all| to activate all of
these. You can repeat this option more than once to activate multiple
categories. If you specify |-D| or |--debug| without the argument
\meta{category}, it activates all available debug categories.
\end{clopt}

\begin{clopt}{\sopt{h}, \lopt{help}}
Shows a quick help message (namely a list of command-line options) and exit
successfully. When this is specified, all other options and arguments are
ignored.
\end{clopt}

\begin{clopt}{\sopt{q}, \lopt{quiet}}
This suppress most of the messages from the program.
\end{clopt}

\begin{clopt}{\sopt{s}, \lopt{silent}}
Silence messages from invoked programs. To be more specific, this redirects
both standard output and standard error streams to the null device.
\end{clopt}

\begin{clopt}{\sopt{v}, \lopt{verbose}}
Make \prog{llmk} to print additional information such as invoked commands
with options and arguments by the program.
\end{clopt}

\begin{clopt}{\sopt{V}, \lopt{version}}
Shows the current version of the program and exit successfully. When this is
specified, all other options and arguments are ignored.
\end{clopt}

\subsection{Exit codes}

You can grasp whether \prog{llmk} successfully executed or not by seeing its
status code. Note that the exit codes of invoked programs are not directly
transferred as the exit code of \prog{llmk}; instead, the statuses of external
programs that failed, if any, are reported in the error messages.
%
\begin{description}[left=2em]
\item[\code{0}]
  Success.
\item[\code{1}]
  General error.
\item[\code{2}]
  Invoked program failed.
\item[\code{3}]
  Parser error.
\item[\code{4}]
  Type error.
\end{description}

\section{Writing workflows in TOML format}
\label{sec:toml}

The primary configuration format for \prog{llmk} is TOML\Dash Tom's Obvious
Minimal Language~\cite{toml}. You can specify the workflows to process your
{\LaTeX} documents in the format either in the special configuration file
(\code{llmk.toml}) or in the TOML field (Section~\ref{sec:toml-where}). You
have full access to the \prog{llmk} configuration with this primary format,
while other supported magic comment formats (Section~\ref{sec:magic-comment})
have only partial access. You can read the entire TOML specification at
\href{https://toml.io/}{its website}.

\subsection{TOML in \prog{llmk}}

The configuration for \prog{llmk} written in the TOML format is read by our
built-in parser. At this point, the built-in parser supports subset of the TOML
specification; only the data-types that necessary for the configuration keys
(Section~\ref{sec:top-level-keys}~\&~\ref{sec:programs-table}) are supported:
%
\par
%
\begin{center}
\let\ok\checkmark
\begin{tabular}{llc}
\toprule
Type & Example & Supported \\ \midrule
Bare keys & \code{key} & \ok \\
Quoted keys & \code{"key"} & \\
Dotted keys & \code{tex.latex} & \ok \\ \midrule
Basic strings & \code{"str"} & \ok \\
Multi-line basic strings & & \\
Literal strings & \code{'str'} & \ok \\
Multi-line literal strings & & \\ \midrule
Integer & \code{123} & \ok \\ \midrule
Boolean & \code{true} & \ok \\ \midrule
Float & \code{3.14} & \\ \midrule
Date \& Time & \code{1979-05-27} & \\ \midrule
Array & \code{[1, 2, 3]} & \ok \\ \midrule
Table & \code{[table]} & \ok \\
Inline table & & \\
Array of table & \code{[[fruit]]} & \\
\bottomrule
\end{tabular}
\end{center}

\subsection{Where to write and how it works}
\label{sec:toml-where}

\subsection{Top-level keys}
\label{sec:top-level-keys}

\subsection{The \code{programs} table}
\label{sec:programs-table}

\section{Other supported formats}
\label{sec:magic-comment}

\section{Acknowledgements}

This project has been supported by the {\TeX} Development Fund created by the {\TeX}
Users Group (No.~29). I would like to thank all contributors and the people who
gave me advice and suggestions for new features for the \prog{llmk} project.

\begin{thebibliography}{9}
\bibitem{asakura2020}
  Takuto Asakura. \textit{The design concept for \prog{llmk}\Dash Light {\LaTeX}
  Make}. TUGboat, Volume~41, No.~2. (2020)

\bibitem{arara}
  Paulo Cereda, et al. \textit{arara\Dash The cool {\TeX} automation
  tool}. \url{https://ctan.org/pkg/arara}

\bibitem{latexmk}
  John Collins. \textit{latexmk\Dash generate {\LaTeX} document}.
  \url{https://ctan.org/pkg/latexmk}

\bibitem{toml}
  Tom Preston-Werner. \textit{TOML: Tom's Obvious Minimal Language}.
  \url{https://toml.io/}
\end{thebibliography}

\end{document}
% vim: set spell:
